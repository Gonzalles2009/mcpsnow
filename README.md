# Простой доступ к Snowflake для ИИ-помощника (с поддержкой MCP)

Эта штука позволяет вашему ИИ-помощнику (например, в Cursor IDE, Claude Desktop или другом клиенте, поддерживающем Model Context Protocol - MCP) безопасно заглядывать в вашу базу данных Snowflake и получать оттуда информацию.

## Что нужно заранее?

Прежде чем начать, убедитесь, что у вас есть:

1.  **Клиент с поддержкой MCP:** Например, Cursor IDE или Claude Desktop. Установленный и рабочий.
2.  **Аккаунт Snowflake:** Вам нужны данные для входа (Account ID, Имя пользователя, Пароль, База данных, Схема, Warehouse). Получите их у того, кто вам дал доступ к Snowflake.
3.  **Инструмент Go:** Это язык программирования. Если у вас его нет, его нужно установить. Инструкции по установке можно найти на официальном сайте [golang.org](https://golang.org/).
4.  **Код этой программы:** Все файлы должны быть в одной папке (например, `mcpsnow`).

## Как запустить (По шагам)

Делаем все аккуратно, шаг за шагом:

**Шаг 1: Открываем Терминал**

*   Терминал — это такая программа для ввода команд текстом.
*   На macOS: Откройте `Launchpad` (значок ракеты), в поиске введите "Терминал" и запустите его.
*   На Windows: Нажмите `Win` + `R`, введите `cmd` и нажмите Enter.
*   Вы увидите черное (или белое) окно, куда можно вводить команды.

**Шаг 2: Заходим в папку с программой**

*   Нужно сказать Терминалу, где лежит наша программа.
*   Скопируйте команду ниже, заменив `/полный/путь/к/папке/mcpsnow` на реальный путь к папке, где лежат файлы этой программы (например, `/Users/aleksandrkud/DevProj/mcpsnow`).
    ```bash
    cd /полный/путь/к/папке/mcpsnow 
    ```
*   Вставьте эту команду в Терминал и нажмите Enter.

**Шаг 3: Собираем программу**

*   Теперь нужно из исходного кода сделать готовую программу, которую поймет компьютер.
*   Скопируйте и вставьте эту команду в Терминал (убедитесь, что вы все еще в папке проекта):
    ```bash
    go build -tags netgo -o mcp_snowflake_server main.go
    ```
*   Нажмите Enter. Если все хорошо, никаких сообщений не будет, но в папке появится новый файл `mcp_snowflake_server` (или `mcp_snowflake_server.exe` на Windows).
    *   *(Пояснение для любопытных: `-tags netgo` - это специальный флажок, чтобы программа лучше работала с сетью в некоторых средах).* 

**Шаг 4: Настраиваем ваш MCP клиент (Cursor, Claude Desktop и т.д.)**

*   Нужно сказать вашему клиенту (Cursor, Claude Desktop...), где найти нашу программу и как к ней подключиться. Это делается через специальный конфигурационный файл.
*   **Для Cursor IDE:**
    *   Откройте папку с вашим проектом (где лежит `mcpsnow`) в Cursor.
    *   Найдите в дереве файлов слева папку `.cursor` (она может быть скрытой). Если ее нет, создайте.
    *   Внутри папки `.cursor` создайте (или откройте, если уже есть) файл с именем `mcp.json`.
*   **Для Claude Desktop:**
    *   Найдите файл конфигурации `claude_desktop_config.json`. Обычно он находится:
        *   На macOS: `~/Library/Application Support/Claude/claude_desktop_config.json`
        *   На Windows: `%APPDATA%\Claude\claude_desktop_config.json`
*   **Для других клиентов:** Обратитесь к документации вашего клиента, чтобы найти его файл конфигурации MCP серверов.

*   **Общий формат конфигурации:** Откройте найденный конфигурационный файл (`mcp.json`, `claude_desktop_config.json` и т.п.) и добавьте (или измените существующую) секцию `mcpServers`, чтобы она выглядела так:

    ```json
    {
      "mcpServers": {
        // ... могут быть другие ваши серверы ...
        "snowflake": {
          "command": "/ЗАМЕНИТЕ/ЭТО/НА/ПОЛНЫЙ/ПУТЬ/К/mcpsnow/mcp_snowflake_server",
          "env": {
            "SNOWFLAKE_ACCOUNT": "ВАШ_SNOWFLAKE_ACCOUNT_ID", 
            "SNOWFLAKE_USER": "ВАШЕ_ИМЯ_ПОЛЬЗОВАТЕЛЯ",
            "SNOWFLAKE_PASSWORD": "ВАШ_ПАРОЛЬ",
            "SNOWFLAKE_DATABASE": "ИМЯ_БАЗЫ_ДАННЫХ",
            "SNOWFLAKE_SCHEMA": "ИМЯ_СХЕМЫ",
            "SNOWFLAKE_WAREHOUSE": "ИМЯ_WAREHOUSE"
            // "SNOWFLAKE_ROLE": "ваша_роль" // Опционально
          }
        }
        // ... могут быть другие ваши серверы ...
      }
    }
    ```
*   **Очень важно:**
    1.  Замените `/ЗАМЕНИТЕ/ЭТО/НА/ПОЛНЫЙ/ПУТЬ/К/mcpsnow/mcp_snowflake_server` на **полный абсолютный путь** к файлу `mcp_snowflake_server` (или `mcp_snowflake_server.exe` на Windows), который вы собрали на Шаге 3. Например: `/Users/aleksandrkud/DevProj/mcpsnow/mcp_snowflake_server`.
    2.  Замените `ВАШ_SNOWFLAKE_ACCOUNT_ID`, `ВАШЕ_ИМЯ_ПОЛЬЗОВАТЕЛЯ`, `ВАШ_ПАРОЛЬ` и т.д. на ваши **настоящие данные** для входа в Snowflake.
*   Сохраните конфигурационный файл.

**Шаг 5: Перезапускаем ваш MCP клиент**

*   Полностью закройте программу (Cursor, Claude Desktop...) и запустите ее снова. Это нужно, чтобы она увидела новые настройки.

**Шаг 6: Проверяем настройки в клиенте**

*   В вашем клиенте (Cursor, Claude Desktop...) найдите раздел настроек, где отображаются подключенные MCP серверы (например, `Settings` -> `MCP Servers` в Cursor).
*   Вы должны увидеть там сервер "snowflake". Рядом с ним должен быть индикатор успешного подключения (например, зеленый кружок) и должен быть указан доступный инструмент `execute_query`.

**Готово! Если все шаги выполнены правильно, ваш ИИ-помощник теперь может общаться с Snowflake.**

## Как использовать в чате

Просто попросите помощника что-нибудь сделать с базой данных Snowflake:

*   "Покажи мне все базы данных в Snowflake."
*   "Можешь выполнить запрос `SELECT email FROM users LIMIT 5` в Snowflake?"
*   "Узнай структуру таблицы `products` в Snowflake."

Помощник сам поймет, что нужно использовать настроенный вами сервер `snowflake` и его инструмент `execute_query`.

## Если что-то не работает

*   **Индикатор подключения не горит / Сервер не виден в настройках?**
    *   Перепроверьте **полный путь** к программе в конфигурационном файле (Шаг 4). Ошибки в пути - частая причина.
    *   Убедитесь, что вы точно перезапустили ваш MCP клиент после сохранения конфигурации (Шаг 5).
    *   Проверьте еще раз команду сборки на Шаге 3 (нужен флаг `-tags netgo`). Попробуйте собрать программу снова.
    *   Перепроверьте **все данные для входа** в Snowflake в конфигурационном файле (Шаг 4). Может быть, где-то опечатка?
    *   Проверьте логи вашего MCP клиента (например, `View` -> `Output` -> `Cursor MCP` в Cursor) на наличие ошибок при попытке запуска сервера.
*   **Помощник говорит, что не может выполнить запрос?**
    *   Возможно, у вашего пользователя Snowflake недостаточно прав. Уточните у того, кто давал вам доступ.
    *   Помните: эта программа умеет только *смотреть* данные (`SELECT`, `SHOW`), но не изменять (`INSERT`, `UPDATE`, `DELETE`). Если вы просите что-то изменить, она откажется – это для безопасности.

## Docker поддержка

Если вам нужно запускать сервер в контейнере, вы можете использовать включенный Dockerfile:

```bash
# Сборка Docker-образа
# Убедитесь, что в Dockerfile используется команда сборки с -tags netgo
docker build -t mcp-snowflake-server .

# Запуск контейнера (пример, может потребоваться адаптация для передачи env)
# Проще всего передавать env через опции -e docker run
docker run --rm -e SNOWFLAKE_ACCOUNT=... -e SNOWFLAKE_USER=... и т.д. mcp-snowflake-server
```

## Расширение функциональности

Текущая реализация поддерживает один инструмент `execute_query` для выполнения SQL запросов. Вы можете легко расширить сервер, добавив другие инструменты, например:

* Получение списка таблиц
* Получение схемы таблицы
* Управление правами доступа (с осторожностью!)
* и т.д.

Для добавления новых инструментов, отредактируйте файл `main.go` и реализуйте необходимую логику, затем пересоберите сервер. 